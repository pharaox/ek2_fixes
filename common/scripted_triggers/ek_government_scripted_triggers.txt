### To replace most of the faith = { religion_tag = islam_religion }, in case we ever want to re-add Clan government
has_feudal_like_government = {
	OR = {
		has_government = feudal_government
		has_government = clan_government
		has_government = autocracy_government
		has_government = hierocracy_government
		has_government = praxis_government
	}
}

### For government types that have similar succession laws to feudal
has_feudal_like_succession = {
	OR = {
		has_government = feudal_government
		has_government = clan_government
		has_government = autocracy_government
		has_government = praxis_government
	}
}

government_has_vassal_contract = { # In vanilla only feudal_government uses vassal contract
	OR = {
		# Vanilla - Playable
		has_government = feudal_government
		has_government = clan_government
		has_government = tribal_government
		
		# Vanilla - Unplayable
		has_government = republic_government
		has_government = theocracy_government
		
		# EK
		has_government = hierocracy_government
		has_government = autocracy_government
		has_government = landed_order_government
		has_government = praxis_government
	}
}

should_use_clan_government = {
	always = no
}
should_use_feudal_government = {
	culture = { has_cultural_parameter = unlocks_feudal_government }
	exists = capital_province
	trigger_if = {
		limit = { exists = capital_province }
		capital_province = { has_holding_type = castle_holding }
	}
}
should_use_praxis_government = {
	OR = {
		AND = {
			culture = { has_cultural_parameter = unlocks_praxis_government }
			exists = capital_province
			trigger_if = {
				limit = { exists = capital_province }
				capital_province = { has_holding_type = castle_holding }
			}
			faith = {
				has_doctrine = tenet_legalism
				has_doctrine = tenet_divine_purity
				has_doctrine = doctrine_pantheon_aedra
			}
		}
		faith = {
			has_doctrine = doctrine_divine_blood_head
			religious_head = prev
		}
	}
}
should_use_hierocracy_government = {
	faith = {
		has_doctrine = doctrine_mystical_birthright_head
		religious_head = prev
	}
}
should_use_autocracy_government = {
	NOR = {
		should_use_clan_government = yes
		should_use_feudal_government = yes
		should_use_hierocracy_government = yes
		should_use_praxis_government = yes
		should_use_landed_order_government = yes
	}
}

should_use_landed_order_government = {
	OR = {
		has_title = title:d_dawnguard
		has_title = title:d_pale_watch
		has_title = title:d_order_of_the_hour
	}
}

# Obligations level
# We need scope:liege, scope:vassal, and OBLIGATION_LEVEL (none/opinion/devotion/fame/prowess/...)
vassal_should_use_obligation = {
	trigger_if = {
		limit = { $OBLIGATION_LEVEL$ = flag:prowess }
		custom_tooltip = {
			text = prowess_obligations_requirement
			scope:vassal = { can_use_obligation_prowess = yes }
		}	
	}
	trigger_else_if = {
		limit = { $OBLIGATION_LEVEL$ = flag:arcana }
		custom_tooltip = {
			text = arcana_obligations_requirement
			scope:vassal = {
				can_use_obligation_arcana = yes
				NOT = { has_unique_obligation_level = yes }
			}
		}	
	}
	trigger_else_if = {
		limit = { $OBLIGATION_LEVEL$ = flag:fame }
		scope:vassal = {
			can_use_obligation_fame = yes
			NOT = { has_unique_obligation_level = yes }
		}
	}
	trigger_else_if = {
		limit = { $OBLIGATION_LEVEL$ = flag:devotion }
		custom_tooltip = {
			text = devotion_obligations_requirement
			OR = {
				scope:vassal = {
					can_use_obligation_devotion = yes
					NOT = { has_unique_obligation_level = yes }
				}
				scope:liege = { has_government = hierocracy_government }
			}	
		}	
	}
	trigger_else_if = {
		limit = { $OBLIGATION_LEVEL$ = flag:opinion }
		scope:vassal = {
			NOR = {
				has_government = feudal_government
				# Band-aix fix, have that one as the default for non-feudal
				# can_use_obligation_prowess = yes
				# can_use_obligation_arcana = yes
				# can_use_obligation_fame = yes
				# can_use_obligation_devotion = yes
			}
		}
	}
	trigger_else_if = {
		limit = { $OBLIGATION_LEVEL$ = flag:none }
		always = yes
	}
	trigger_else = {
		always = no
	}
}

can_use_obligation_prowess = {
	NOT = { has_government = feudal_government }
	faith = { has_doctrine_parameter = vassal_contribution_tied_prowess }
}

can_use_obligation_arcana = {	
	NOT = { has_government = feudal_government }
	OR = {
		AND = {
			exists = dynasty
			dynasty = { has_dynasty_perk = magicka_legacy_4 }
		}
		culture = { has_cultural_parameter = vassal_contribution_tied_arcana } 
	}	
}

can_use_obligation_fame = {
	NOT = { has_government = feudal_government }
	has_government = tribal_government
}

can_use_obligation_devotion = {
	NOT = { has_government = feudal_government }
	has_government = theocracy_government
}

has_unique_obligation_level = {
	OR = {
		has_culture_obligation_level = yes
		has_faith_obligation_level = yes
	}
}

has_culture_obligation_level = {
	always = no
}

has_faith_obligation_level = {
	faith = { has_doctrine_parameter = vassal_contribution_tied_prowess }
}

is_great_house_head = {
	OR = {
		has_title = title:k_hlaalu
		has_title = title:k_dres
		has_title = title:k_redoran
		has_title = title:k_indoril
		has_title = title:k_telvanni
	}
}